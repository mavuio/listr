// Generated by CoffeeScript 1.6.2
angular.module("listr").directive("listrContainer", function() {
  return {
    restrict: "EA",
    replace: true,
    template: '<div></div>',
    scope: {
      src: '@',
      prefix: '@'
    },
    link: function(scope, element, attrs) {
      if (window.console && console.log) {
        return console.log("listr container init", null);
      }
    },
    controller: [
      "$scope", "$element", "$attrs", "$timeout", "$filter", "$http", "$q", "statemanager", function($scope, $element, $attrs, $timeout, $filter, $http, $q, statemanager) {
        var listrApiUrl;

        $scope.query = {};
        $scope.items = {};
        listrApiUrl = $scope.src + '/listr';
        if (!$scope.prefix) {
          $scope.prefix = 'listr';
        }
        $scope.refreshListing = function() {
          var page;

          if (window.console && console.log) {
            console.log("âžœ  refreshListing");
          }
          page = $scope.query.page;
          if (page < 0) {
            page = 1;
          }
          return $http.post(listrApiUrl, {
            action: 'get_items',
            prefix: $scope.prefix,
            query: $scope.query,
            page: page
          }, function(response) {
            $scope.items = response.items.data;
            $scope.allItems = response.items;
            return $scope.listmode = 'loaded';
          }, function(error) {
            if (window.console && console.log) {
              console.log("error:", error);
            }
            return $scope.items = [];
          });
        };
        $scope.$watch((function() {
          return statemanager.get("query");
        }), (function(query) {
          if (window.console && console.log) {
            return console.log("listr-container: state-change detected", null);
          }
        }), true);
        return $scope.refreshListing();
      }
    ]
  };
});

if (window.console && console.log) {
  console.log("drectvie defined", null);
}

/*
//@ sourceMappingURL=listr-container.map
*/
